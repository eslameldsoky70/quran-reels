<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†ÙˆØ± Ø§Ù„Ø±ÙŠÙ„Ø² ğŸŒ™</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700;900&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden;font-family:'Cairo',sans-serif;background:#070e09;color:#f0ebe1;direction:rtl}
body::before{content:'';position:fixed;inset:0;pointer-events:none;opacity:.04;z-index:0;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cpolygon points='60,3 72,42 110,42 80,65 90,104 60,82 30,104 40,65 10,42 48,42' fill='none' stroke='%23c9973a' stroke-width='1'/%3E%3C/svg%3E")}
.app{display:grid;grid-template-rows:54px 1fr;height:100vh;position:relative;z-index:1}
.main{display:grid;grid-template-columns:275px 1fr 260px;overflow:hidden}

/* TOPBAR */
.top{background:rgba(7,14,9,.98);border-bottom:1px solid rgba(201,151,58,.15);display:flex;align-items:center;padding:0 16px;gap:10px;flex-shrink:0}
.logo{display:flex;align-items:center;gap:9px;flex-shrink:0}
.logo-icon{width:33px;height:33px;border-radius:50%;background:linear-gradient(135deg,#245c38,#3ea066);display:flex;align-items:center;justify-content:center;font-size:16px}
.logo-text{font-family:'Amiri',serif;font-size:19px;color:#e4b55a}
.tabs{display:flex;gap:4px;margin-right:10px}
.tab{padding:5px 12px;border-radius:100px;font-size:12px;cursor:pointer;border:1px solid rgba(255,255,255,.07);background:transparent;color:#6e8878;transition:.2s;white-space:nowrap}
.tab.on{border-color:rgba(201,151,58,.5);background:rgba(201,151,58,.1);color:#e4b55a}
#statusBar{margin-right:auto;font-size:11px;color:#6e8878;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:280px}
.btn-gold{padding:8px 16px;border-radius:8px;border:none;font-family:'Cairo',sans-serif;font-size:13px;font-weight:700;cursor:pointer;background:linear-gradient(135deg,#6b4e18,#c9973a);color:#fff;flex-shrink:0}

/* PANELS */
.panel{background:#0c1810;overflow-y:auto}
.left{border-left:1px solid rgba(201,151,58,.13)}
.right{border-right:1px solid rgba(201,151,58,.13)}
.sec{padding:12px 14px;border-bottom:1px solid rgba(201,151,58,.1)}
.lbl{font-size:10px;letter-spacing:2px;color:#6e8878;text-transform:uppercase;display:block;margin-bottom:10px}

/* SHEIKH CARDS */
.sh-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.sh-card{border:1px solid rgba(201,151,58,.1);border-radius:10px;padding:9px 7px;cursor:pointer;text-align:center;background:#112016;transition:.2s}
.sh-card:hover,.sh-card.on{border-color:rgba(201,151,58,.55);background:rgba(201,151,58,.08)}
.sh-card.on .sh-name{color:#e4b55a}
.sh-flag{font-size:20px;margin-bottom:4px}
.sh-name{font-size:10px;color:#b5c4bc;line-height:1.3;font-weight:600}
.sh-country{font-size:9px;color:#6e8878;margin-top:2px}

/* SURAH */
.s-inp{width:100%;background:#18301e;border:1px solid rgba(201,151,58,.15);border-radius:8px;color:#f0ebe1;font-family:'Cairo',sans-serif;font-size:13px;padding:7px 11px;outline:none;margin-bottom:8px}
.s-list{max-height:230px;overflow-y:auto;display:flex;flex-direction:column;gap:2px}
.s-item{display:flex;align-items:center;gap:9px;padding:6px 9px;border-radius:7px;cursor:pointer;border:1px solid transparent;transition:.15s}
.s-item:hover{background:#18301e}
.s-item.on{background:rgba(201,151,58,.08);border-color:rgba(201,151,58,.3)}
.s-num{width:22px;height:22px;border-radius:50%;background:#18301e;border:1px solid rgba(201,151,58,.2);display:flex;align-items:center;justify-content:center;font-size:9px;color:#c9973a;flex-shrink:0}
.s-ar{font-family:'Scheherazade New',serif;font-size:16px;flex:1}
.s-v{font-size:9px;color:#6e8878}

/* VERSE RANGE */
.v-range{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.flbl{font-size:10px;color:#6e8878;display:block;margin-bottom:3px}
.finp{width:100%;background:#18301e;border:1px solid rgba(201,151,58,.2);border-radius:7px;color:#f0ebe1;font-family:'Cairo',sans-serif;font-size:14px;padding:7px;outline:none;text-align:center}
.v-list{display:flex;flex-direction:column;gap:4px;max-height:260px;overflow-y:auto}
.v-item{padding:8px 10px;border-radius:9px;cursor:pointer;border:1px solid rgba(255,255,255,.05);background:#112016;transition:.15s;display:flex;gap:8px;align-items:flex-start}
.v-item:hover,.v-item.on{border-color:rgba(201,151,58,.45);background:rgba(201,151,58,.07)}
.v-num{font-size:10px;color:#c9973a;font-weight:700;padding-top:3px;flex-shrink:0;min-width:16px}
.v-ar{font-family:'Scheherazade New',serif;font-size:13px;line-height:1.9;color:#f0ebe1}
.v-en{font-size:9px;color:#6e8878;margin-top:1px;line-height:1.4}

/* BG GRID */
.bg-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px}
.bg-thumb{aspect-ratio:9/16;border-radius:9px;border:2px solid rgba(255,255,255,.07);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:.2s;font-size:19px}
.bg-thumb.on{border-color:#c9973a;box-shadow:0 0 12px rgba(201,151,58,.3)}
.bg-lbl{font-size:9px;color:#b5c4bc;margin-top:3px}

/* CENTER */
.center{background:#070e09;display:flex;flex-direction:column;overflow:hidden}
.stage-bar{padding:7px 14px;border-bottom:1px solid rgba(201,151,58,.1);display:flex;align-items:center;gap:7px;flex-shrink:0}
.pos-btn{padding:4px 12px;border-radius:100px;font-size:12px;border:1px solid rgba(255,255,255,.07);background:transparent;color:#6e8878;cursor:pointer;transition:.2s}
.pos-btn.on{border-color:rgba(201,151,58,.5);background:rgba(201,151,58,.1);color:#e4b55a}
.stage{flex:1;display:flex;align-items:center;justify-content:center;padding:20px;position:relative;overflow:hidden}
.stage-glow{position:absolute;width:450px;height:450px;border-radius:50%;background:radial-gradient(ellipse,rgba(36,92,56,.13),transparent 70%);pointer-events:none}

/* PHONE */
.phone{width:248px;height:440px;border-radius:38px;border:2px solid rgba(255,255,255,.1);background:#000;box-shadow:0 36px 70px rgba(0,0,0,.85),0 0 40px rgba(36,92,56,.2);position:relative;overflow:hidden;flex-shrink:0}
.screen{position:absolute;inset:6px;border-radius:33px;overflow:hidden}
.sc-geo{position:absolute;inset:0;opacity:.04;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='70' height='70'%3E%3Ccircle cx='35' cy='35' r='30' fill='none' stroke='%23c9973a' stroke-width='.7'/%3E%3C/svg%3E")}
.sc-glow{position:absolute;inset:0;background:radial-gradient(ellipse at 50% 45%,rgba(36,92,56,.26),transparent 68%);pointer-events:none}
.sc-moon{position:absolute;top:12px;width:100%;text-align:center;font-size:18px;opacity:.72;animation:float 3.5s ease-in-out infinite}
.sc-basmala{position:absolute;top:38px;width:100%;text-align:center;font-family:'Scheherazade New',serif;font-size:10px;color:rgba(200,160,50,.85)}
.sc-line{position:absolute;right:14px;left:14px;height:1px;background:linear-gradient(to left,transparent,rgba(200,160,50,.4),transparent)}
.sc-verse{position:absolute;right:11px;left:11px;z-index:2;text-align:center}
.sc-verse-ar{line-height:2.1;text-shadow:0 2px 12px rgba(0,0,0,.95);direction:rtl;word-break:break-word}
.sc-verse-ref{margin-top:6px;font-size:9px;color:rgba(200,160,50,.9);font-family:'Cairo',sans-serif}
.sc-verse-en{margin-top:4px;font-size:8.5px;color:rgba(180,200,190,.75);line-height:1.55;direction:ltr}
.sc-info{position:absolute;width:100%;text-align:center;font-family:'Cairo',sans-serif}
.play-dot{position:absolute;top:11px;right:11px;width:7px;height:7px;border-radius:50%;background:#5ec285;box-shadow:0 0 6px #5ec285;animation:twinkle 1s ease-in-out infinite;display:none}
.sc-loader{position:absolute;inset:0;background:rgba(7,14,9,.7);display:flex;align-items:center;justify-content:center;font-size:13px;color:#e4b55a;display:none}

/* PLAYER BAR */
.player{background:#0c1810;border-top:1px solid rgba(201,151,58,.12);padding:11px 18px;flex-shrink:0}
.player-top{display:flex;align-items:center;gap:11px;margin-bottom:8px}
.np-info{flex:1;min-width:0}
.np-title{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.np-sub{font-size:11px;color:#6e8878;margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:.3s}
.player-btns{display:flex;gap:5px;align-items:center;flex-shrink:0}
.pbtn{border-radius:50%;border:1px solid rgba(201,151,58,.2);background:#18301e;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;font-size:13px;flex-shrink:0}
.pbtn:hover{border-color:#c9973a}
.pbtn-main{width:42px;height:42px;border:none!important;font-size:18px;background:linear-gradient(135deg,#245c38,#3ea066);box-shadow:0 4px 12px rgba(36,92,56,.4)}
.pbtn-sm{width:32px;height:32px}
.prog-row{display:flex;align-items:center;gap:9px}
.prog-t{font-size:11px;color:#6e8878;min-width:30px}
.prog-bar{flex:1;height:4px;background:#18301e;border-radius:100px;cursor:pointer;position:relative}
.prog-fill{height:100%;background:linear-gradient(to right,#c9973a,#e4b55a);border-radius:100px;width:0%;transition:.08s}
.prog-dot{width:12px;height:12px;border-radius:50%;background:#e4b55a;position:absolute;top:-4px;left:0%;box-shadow:0 0 6px rgba(201,151,58,.6);pointer-events:none;transform:translateX(-50%)}

/* RIGHT PANEL */
.font-btn{width:100%;padding:8px 11px;border:1px solid rgba(255,255,255,.06);border-radius:7px;background:#112016;cursor:pointer;font-size:14px;color:#b5c4bc;margin-bottom:5px;transition:.2s;direction:rtl;text-align:right}
.font-btn:hover,.font-btn.on{border-color:rgba(201,151,58,.45);color:#f0ebe1;background:rgba(201,151,58,.07)}
.sz-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:7px}
.sz-btn{padding:3px 8px;font-size:10px;border-radius:5px;border:1px solid rgba(255,255,255,.07);background:transparent;color:#6e8878;cursor:pointer;transition:.15s}
.sz-btn:hover,.sz-btn.on{border-color:rgba(201,151,58,.45);background:rgba(201,151,58,.09);color:#e4b55a}
.clr-row{display:flex;gap:6px;flex-wrap:wrap}
.clr{width:26px;height:26px;border-radius:50%;cursor:pointer;border:2.5px solid transparent;transition:.15s}
.clr.on{border-color:#fff;transform:scale(1.2);box-shadow:0 0 7px rgba(255,255,255,.3)}
.sw-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;cursor:pointer;border-bottom:1px solid rgba(255,255,255,.04)}
.sw-lbl{font-size:12px;color:#b5c4bc}
.sw{width:36px;height:20px;border-radius:100px;position:relative;transition:.25s;flex-shrink:0}
.sw-k{width:14px;height:14px;border-radius:50%;background:#fff;position:absolute;top:3px;transition:.25s}

/* EXPORT */
.exp-fill{height:100%;background:linear-gradient(to right,#c9973a,#e4b55a);border-radius:100px;width:0%;transition:.12s}

/* LOADING SCREEN */
#initScreen{position:fixed;inset:0;background:#070e09;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}
.init-moon{font-size:52px;animation:float 2s ease-in-out infinite}
.init-text{font-family:'Amiri',serif;font-size:22px;color:#e4b55a}
.init-sub{font-size:12px;color:#6e8878}
.init-bar{width:200px;height:3px;background:#18301e;border-radius:100px;overflow:hidden;margin-top:8px}
.init-prog{height:100%;background:linear-gradient(to right,#c9973a,#e4b55a);border-radius:100px;width:0%;transition:.4s}

/* TOAST */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:#0c1810;border:1px solid rgba(201,151,58,.55);padding:9px 24px;border-radius:100px;font-size:13px;color:#e4b55a;z-index:9999;white-space:nowrap;box-shadow:0 6px 24px rgba(0,0,0,.6);transition:.3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}

::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:#0c1810}::-webkit-scrollbar-thumb{background:#245c38;border-radius:2px}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes twinkle{0%,100%{opacity:.3}50%{opacity:1}}
input[type=range]{-webkit-appearance:none;width:100%;height:4px;border-radius:2px;background:#18301e;outline:none;border:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:15px;height:15px;border-radius:50%;background:#3ea066;cursor:pointer}
</style>
</head>
<body>

<!-- INIT LOADING -->
<div id="initScreen">
  <div class="init-moon">ğŸŒ™</div>
  <div class="init-text">Ù†ÙˆØ± Ø§Ù„Ø±ÙŠÙ„Ø²</div>
  <div class="init-sub" id="initMsg">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…...</div>
  <div class="init-bar"><div class="init-prog" id="initProg"></div></div>
</div>

<!-- MAIN APP (hidden until loaded) -->
<div class="app" id="mainApp" style="display:none">

<!-- TOPBAR -->
<div class="top">
  <div class="logo">
    <div class="logo-icon">ğŸŒ™</div>
    <span class="logo-text">Ù†ÙˆØ± Ø§Ù„Ø±ÙŠÙ„Ø²</span>
  </div>
  <div class="tabs">
    <div class="tab on"  onclick="switchTab('sheikh')">ğŸ™ Ø§Ù„Ø´ÙŠÙˆØ®</div>
    <div class="tab"     onclick="switchTab('surah')">ğŸ“– Ø§Ù„Ø³ÙˆØ±</div>
    <div class="tab"     onclick="switchTab('bg')">ğŸ–¼ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª</div>
  </div>
  <div id="statusBar">Ø§Ø®ØªØ± Ø´ÙŠØ®Ø§Ù‹ ÙˆØ³ÙˆØ±Ø© Ù„Ù„Ø¨Ø¯Ø¡</div>
  <button class="btn-gold" onclick="startExport()">â¬‡ ØªØµØ¯ÙŠØ±</button>
</div>

<!-- MAIN -->
<div class="main">

<!-- LEFT -->
<div class="panel left">
  <div id="tab-sheikh">
    <div class="sec">
      <span class="lbl">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦</span>
      <div class="sh-grid" id="shGrid"></div>
    </div>
  </div>

  <div id="tab-surah" style="display:none">
    <div class="sec">
      <span class="lbl">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©</span>
      <input class="s-inp" type="text" placeholder="Ø§Ø¨Ø­Ø«..." oninput="filterSurahs(this.value)">
      <div class="s-list" id="surahList"></div>
    </div>
    <div class="sec">
      <span class="lbl">Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¢ÙŠØ§Øª</span>
      <div class="v-range">
        <div><span class="flbl">Ù…Ù† Ø¢ÙŠØ©</span><input class="finp" type="number" id="vFrom" value="1" min="1" onchange="onRange()"></div>
        <div><span class="flbl">Ø¥Ù„Ù‰ Ø¢ÙŠØ©</span><input class="finp" type="number" id="vTo"   value="7" min="1" onchange="onRange()"></div>
      </div>
      <button onclick="playFromStart()" style="width:100%;padding:9px;background:linear-gradient(135deg,#245c38,#3ea066);border:none;border-radius:8px;color:#fff;font-family:'Cairo',sans-serif;font-size:13px;font-weight:700;cursor:pointer">â–¶ ØªØ´ØºÙŠÙ„ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
    </div>
    <div class="sec">
      <span class="lbl">Ø§Ù„Ø¢ÙŠØ§Øª â€” Ø§Ù†Ù‚Ø± Ù„ØªØ´ØºÙŠÙ„</span>
      <div class="v-list" id="vList"></div>
    </div>
  </div>

  <div id="tab-bg" style="display:none">
    <div class="sec">
      <span class="lbl">Ø§Ø®ØªØ± Ø§Ù„Ø®Ù„ÙÙŠØ©</span>
      <div class="bg-grid" id="bgGrid"></div>
    </div>
  </div>
</div>

<!-- CENTER -->
<div class="center">
  <div class="stage-bar">
    <span style="font-size:11px;color:#6e8878">Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ:</span>
    <button class="pos-btn"    onclick="setPos(this,'top')">â†‘ Ø£Ø¹Ù„Ù‰</button>
    <button class="pos-btn on" onclick="setPos(this,'center')">âŠ™ ÙˆØ³Ø·</button>
    <button class="pos-btn"    onclick="setPos(this,'bottom')">â†“ Ø£Ø³ÙÙ„</button>
    <span style="margin-right:auto;font-size:10px;color:#6e8878">9:16 Ù…Ø¨Ø§Ø´Ø±</span>
  </div>

  <div class="stage">
    <div class="stage-glow"></div>
    <div class="phone">
      <div class="screen" id="screen" style="background:linear-gradient(160deg,#020d04,#071a0a)">
        <div class="sc-geo"></div>
        <div class="sc-glow" id="elGlow"></div>
        <div id="elStars">
          <div style="position:absolute;top:15px;left:14px;font-size:8px;color:rgba(200,160,50,.7);animation:twinkle 2s infinite;line-height:1">âœ¦</div>
          <div style="position:absolute;top:18px;left:215px;font-size:7px;color:rgba(200,160,50,.5);animation:twinkle 2.5s infinite .5s;line-height:1">âœ¦</div>
          <div style="position:absolute;top:48px;left:13px;font-size:6px;color:rgba(200,160,50,.4);animation:twinkle 3s infinite 1s;line-height:1">âœ¦</div>
        </div>
        <div class="sc-moon" id="elMoon">ğŸŒ™</div>
        <div class="sc-basmala">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <div class="sc-line" style="top:55px"></div>
        <div class="sc-verse" id="verseArea" style="top:50%;transform:translateY(-50%)">
          <div class="sc-verse-ar" id="vAr" style="font-family:'Scheherazade New',serif;font-size:26px;color:#fff">
            Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© ÙˆØ´ÙŠØ®Ø§Ù‹ Ù„Ù„Ø¨Ø¯Ø¡
          </div>
          <div class="sc-verse-ref" id="vRef"></div>
          <div class="sc-verse-en"  id="vEn"></div>
        </div>
        <div class="sc-line" style="bottom:46px"></div>
        <div class="sc-info" id="elSheikh" style="bottom:30px;font-size:8px;color:rgba(140,190,160,.6)"></div>
        <div class="sc-info" id="elWm"     style="bottom:11px;font-size:8px;color:rgba(255,255,255,.3)"></div>
        <div class="play-dot" id="playDot"></div>
        <div class="sc-loader" id="scLoader">âŸ³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </div>
  </div>

  <!-- PLAYER -->
  <div class="player">
    <div class="player-top">
      <div class="np-info">
        <div class="np-title" id="npTitle">Ù†ÙˆØ± Ø§Ù„Ø±ÙŠÙ„Ø² ğŸŒ™</div>
        <div class="np-sub"   id="npSub">Ø§Ø®ØªØ± Ø´ÙŠØ®Ø§Ù‹ ÙˆØ³ÙˆØ±Ø© Ù„Ù„Ø¨Ø¯Ø¡</div>
      </div>
      <div class="player-btns">
        <button class="pbtn pbtn-sm" onclick="prevVerse()" title="Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">â®</button>
        <button class="pbtn pbtn-main" id="mainBtn" onclick="togglePlay()">â–¶</button>
        <button class="pbtn pbtn-sm" onclick="nextVerse()" title="Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©">â­</button>
      </div>
    </div>
    <div class="prog-row">
      <span class="prog-t" id="tCur">0:00</span>
      <div class="prog-bar" id="progBar" onclick="seekClick(event)">
        <div class="prog-fill" id="pFill"></div>
        <div class="prog-dot"  id="pDot"></div>
      </div>
      <span class="prog-t" id="tDur" style="text-align:left">0:00</span>
    </div>
  </div>
</div>

<!-- RIGHT -->
<div class="panel right">
  <div class="sec">
    <span class="lbl">Ù†Ù…Ø· Ø§Ù„Ø®Ø·</span>
    <button class="font-btn on" style="font-family:'Scheherazade New',serif" onclick="setFont(this,'scheherazade')">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù â€” Ø¹Ø«Ù…Ø§Ù†ÙŠ</button>
    <button class="font-btn"    style="font-family:'Amiri',serif"            onclick="setFont(this,'amiri')">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ â€” Ø£Ù…ÙŠØ±ÙŠ</button>
    <button class="font-btn"    style="font-family:'Cairo',sans-serif"       onclick="setFont(this,'cairo')">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ â€” ÙƒØ§ÙŠØ±Ùˆ</button>
  </div>
  <div class="sec">
    <span class="lbl">Ø­Ø¬Ù… Ø§Ù„Ø®Ø· â€” <span id="fsLbl">26</span>px</span>
    <input id="fsRange" type="range" min="16" max="52" value="26" oninput="setSize(+this.value)">
    <div class="sz-row">
      <button class="sz-btn" onclick="setSize(18)">18</button>
      <button class="sz-btn" onclick="setSize(22)">22</button>
      <button class="sz-btn on" onclick="setSize(26)">26</button>
      <button class="sz-btn" onclick="setSize(30)">30</button>
      <button class="sz-btn" onclick="setSize(36)">36</button>
      <button class="sz-btn" onclick="setSize(44)">44</button>
    </div>
  </div>
  <div class="sec">
    <span class="lbl">Ù„ÙˆÙ† Ø§Ù„Ù†Øµ</span>
    <div class="clr-row">
      <div class="clr on" style="background:#fff"     onclick="setColor('#fff',this)"></div>
      <div class="clr"    style="background:#f5d990"  onclick="setColor('#f5d990',this)"></div>
      <div class="clr"    style="background:#c9973a"  onclick="setColor('#c9973a',this)"></div>
      <div class="clr"    style="background:#9ddbb8"  onclick="setColor('#9ddbb8',this)"></div>
      <div class="clr"    style="background:#aecbd8"  onclick="setColor('#aecbd8',this)"></div>
      <div class="clr"    style="background:#f4c4c4"  onclick="setColor('#f4c4c4',this)"></div>
    </div>
  </div>
  <div class="sec">
    <span class="lbl">Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª</span>
    <div class="sw-row" onclick="toggleFx('moon')">  <span class="sw-lbl">ğŸŒ™ Ù‡Ù„Ø§Ù„ Ù…ØªØ­Ø±Ùƒ</span>   <div class="sw on-sw" id="sw-moon"  style="background:linear-gradient(135deg,#245c38,#3ea066);border:1px solid rgba(62,160,102,.4)"><div class="sw-k" style="right:3px"></div></div></div>
    <div class="sw-row" onclick="toggleFx('stars')"> <span class="sw-lbl">âœ¦ Ù†Ø¬ÙˆÙ…</span>           <div class="sw on-sw" id="sw-stars" style="background:linear-gradient(135deg,#245c38,#3ea066);border:1px solid rgba(62,160,102,.4)"><div class="sw-k" style="right:3px"></div></div></div>
    <div class="sw-row" onclick="toggleFx('glow')">  <span class="sw-lbl">ğŸŒŸ Ù‡Ø§Ù„Ø© Ù†ÙˆØ±Ø§Ù†ÙŠØ©</span>   <div class="sw on-sw" id="sw-glow"  style="background:linear-gradient(135deg,#245c38,#3ea066);border:1px solid rgba(62,160,102,.4)"><div class="sw-k" style="right:3px"></div></div></div>
    <div class="sw-row" onclick="toggleFx('trans')"> <span class="sw-lbl">ğŸŒ Ø§Ù„ØªØ±Ø¬Ù…Ø©</span>        <div class="sw on-sw" id="sw-trans" style="background:linear-gradient(135deg,#245c38,#3ea066);border:1px solid rgba(62,160,102,.4)"><div class="sw-k" style="right:3px"></div></div></div>
  </div>
  <div class="sec">
    <span class="lbl">Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ©</span>
    <input type="text" class="s-inp" placeholder="@Ù‚Ù†Ø§ØªÙƒ" oninput="document.getElementById('elWm').textContent=this.value" style="margin:0">
  </div>
  <div class="sec">
    <span class="lbl">Ø§Ù„ØªØµØ¯ÙŠØ±</span>
    <button onclick="startExport()" style="width:100%;padding:12px;background:linear-gradient(135deg,#6b4e18,#c9973a);border:none;border-radius:11px;color:#fff;font-family:'Cairo',sans-serif;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 4px 18px rgba(201,151,58,.3)">âš¡ ØªØµØ¯ÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
    <div id="expBox" style="display:none;margin-top:10px">
      <div style="height:4px;background:#18301e;border-radius:100px;overflow:hidden"><div class="exp-fill" id="expFill"></div></div>
      <div style="display:flex;justify-content:space-between;font-size:11px;color:#6e8878;margin-top:4px"><span id="expMsg">Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</span><span id="expPct" style="color:#e4b55a">0%</span></div>
    </div>
  </div>
</div>

</div><!-- /main -->
</div><!-- /app -->

<div class="toast" id="toast"></div>
<audio id="audio" preload="auto"></audio>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Ø§Ù„Ø´ÙŠÙˆØ® â€” ID Ù…Ù† the-quran-project (Ø¢ÙŠØ§Øª Ù…Ù†ÙØ±Ø¯Ø©)
const SHUYUKH = [
  {id:1, name:"Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ",    flag:"ğŸ‡°ğŸ‡¼", country:"Ø§Ù„ÙƒÙˆÙŠØª"},
  {id:2, name:"Ø£Ø¨Ùˆ Ø¨ÙƒØ± Ø§Ù„Ø´Ø§Ø·Ø±ÙŠ", flag:"ğŸ‡©ğŸ‡¿", country:"Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±"},
  {id:3, name:"Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ",    flag:"ğŸ‡¸ğŸ‡¦", country:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"},
  {id:4, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³", flag:"ğŸ‡¸ğŸ‡¦", country:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"},
  {id:5, name:"Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­ØµØ±ÙŠ",     flag:"ğŸ‡ªğŸ‡¬", country:"Ù…ØµØ±"},
  {id:6, name:"Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…",      flag:"ğŸ‡¸ğŸ‡¦", country:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"},
  {id:7, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨ØµÙØ±",     flag:"ğŸ‡¸ğŸ‡¦", country:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"},
  {id:8, name:"Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø·Ø§Ù…ÙŠ",     flag:"ğŸ‡¸ğŸ‡¦", country:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"},
];

const SURAHS = [
  {n:1,ar:"Ø§Ù„ÙØ§ØªØ­Ø©",v:7},  {n:2,ar:"Ø§Ù„Ø¨Ù‚Ø±Ø©",v:286},  {n:3,ar:"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†",v:200},
  {n:18,ar:"Ø§Ù„ÙƒÙ‡Ù",v:110}, {n:19,ar:"Ù…Ø±ÙŠÙ…",v:98},    {n:36,ar:"ÙŠØ³",v:83},
  {n:55,ar:"Ø§Ù„Ø±Ø­Ù…Ù†",v:78}, {n:56,ar:"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©",v:96}, {n:67,ar:"Ø§Ù„Ù…Ù„Ùƒ",v:30},
  {n:78,ar:"Ø§Ù„Ù†Ø¨Ø£",v:40},  {n:93,ar:"Ø§Ù„Ø¶Ø­Ù‰",v:11},   {n:94,ar:"Ø§Ù„Ø´Ø±Ø­",v:8},
  {n:97,ar:"Ø§Ù„Ù‚Ø¯Ø±",v:5},   {n:112,ar:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ",v:4}, {n:113,ar:"Ø§Ù„ÙÙ„Ù‚",v:5},
  {n:114,ar:"Ø§Ù„Ù†Ø§Ø³",v:6},
];

const BGS = [
  {l:"Ù…Ø³Ø¬Ø¯", e:"ğŸ•Œ",g:"linear-gradient(160deg,#020d04,#071a0a)"},
  {l:"Ø§Ù„ÙƒØ¹Ø¨Ø©",e:"ğŸ•‹",g:"linear-gradient(160deg,#050510,#0d0d22)"},
  {l:"Ù„ÙŠÙ„",  e:"ğŸŒ™",g:"linear-gradient(160deg,#02030e,#060820)"},
  {l:"Ø·Ø¨ÙŠØ¹Ø©",e:"ğŸŒ¿",g:"linear-gradient(160deg,#020a02,#071407)"},
  {l:"ØºØ±ÙˆØ¨", e:"ğŸŒ…",g:"linear-gradient(160deg,#100600,#1e0c00)"},
  {l:"Ø¨Ø­Ø±",  e:"ğŸŒŠ",g:"linear-gradient(160deg,#020a12,#051828)"},
  {l:"Ø°Ù‡Ø¨ÙŠ", e:"âœ¨",g:"linear-gradient(160deg,#0c0800,#1c1200)"},
  {l:"Ø¯Ø§ÙƒÙ†", e:"â¬›",g:"linear-gradient(160deg,#060606,#0c0c0c)"},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let S = {
  sheikh: null,
  surah:  null,
  data:   [],        // [{ar, en}, ...] â€” ÙƒÙ„ Ø¢ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ±Ø©
  vFrom:  1,
  vTo:    7,
  active: 0,         // index Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ slice (0-based)
  bgIdx:  0,
  font:   'scheherazade',
  size:   26,
  color:  '#fff',
  pos:    'center',
  fx:     {moon:true, stars:true, glow:true, trans:true},
  playing: false,
};

const audio  = document.getElementById('audio');
const arN    = n => String(n).replace(/\d/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);
const fmt    = s => !s||isNaN(s) ? '0:00' : `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;

// Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙˆØ±Ø© (1-based)
const curAyahNum = () => S.vFrom + S.active;

// Ø§Ù„Ù€ slice Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø¢ÙŠØ§Øª
const curSlice = () => S.data.slice(S.vFrom - 1, S.vTo);

// Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
const curVerse = () => curSlice()[S.active] || S.data[0] || {ar:'', en:''};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST / STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastT;
const toast$ = m => {
  const t = document.getElementById('toast');
  t.textContent = m; t.classList.add('show');
  clearTimeout(toastT);
  toastT = setTimeout(() => t.classList.remove('show'), 3000);
};

const setStatus = (m, c='#6e8878') => {
  const b = document.getElementById('statusBar');
  b.textContent = m; b.style.color = c;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QURAN DATA â€” Ø¬Ù„Ø¨ Ù…Ù† quran-json Ø¹Ù„Ù‰ jsDelivr
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const cache = {};

async function loadSurahData(n) {
  if (cache[n]) return cache[n];
  const [arRes, enRes] = await Promise.all([
    fetch(`https://cdn.jsdelivr.net/npm/quran-json@3.1.2/dist/chapters/${n}.json`),
    fetch(`https://cdn.jsdelivr.net/npm/quran-json@3.1.2/dist/chapters/en/${n}.json`),
  ]);
  const arArr = await arRes.json();  // [{id, verse}, ...]
  const enArr = await enRes.json();
  const verses = arArr.map((v, i) => ({
    ar: v.verse,
    en: enArr[i]?.verse || '',
    n: v.id,
  }));
  cache[n] = verses;
  return verses;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let pendingPlay = false;
let currentUrl  = '';

// URL Ø§Ù„Ø¢ÙŠØ©: the-quran-project GitHub Pages
// Format: /Data/{reciterID}/{surahNo}_{ayahNo}.mp3
const ayahUrl = (sh, sn, an) =>
  `https://the-quran-project.github.io/Quran-Audio/Data/${sh.id}/${sn}_${an}.mp3`;

function loadAudio(autoPlay = false) {
  if (!S.sheikh || !S.surah || !S.data.length) return;
  const url = ayahUrl(S.sheikh, S.surah.n, curAyahNum());
  if (url === currentUrl && audio.readyState >= 2) {
    if (autoPlay) doPlay();
    return;
  }
  currentUrl  = url;
  pendingPlay = autoPlay;
  if (!audio.paused) { audio.pause(); audio.currentTime = 0; }
  setStatus('âŸ³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ©...', '#e4b55a');
  document.getElementById('npSub').textContent = S.sheikh.name + ' Â· âŸ³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
  document.getElementById('npSub').style.color = '#e4b55a';
  audio.src = url;
  audio.load();
}

function doPlay() {
  const p = audio.play();
  if (p?.catch) p.catch(e => {
    if (e.name !== 'AbortError') { setStatus('âŒ ' + e.message, '#f47c7c'); }
  });
}

// â”€â”€ Ø­ÙˆØ§Ø¯Ø« Ø§Ù„ØµÙˆØª â”€â”€
audio.addEventListener('canplay', () => {
  setStatus('â— Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„', '#5ec285');
  document.getElementById('npSub').textContent = S.sheikh.name + ' Â· Ø¬Ø§Ù‡Ø² âœ…';
  document.getElementById('npSub').style.color = '#5ec285';
  if (pendingPlay) { pendingPlay = false; doPlay(); }
});

audio.addEventListener('playing', () => {
  S.playing = true;
  document.getElementById('mainBtn').innerHTML = 'â¸';
  document.getElementById('mainBtn').style.background = 'linear-gradient(135deg,#5c2424,#a03030)';
  document.getElementById('playDot').style.display = 'block';
  setStatus('â–¶ ÙŠÙØ´ØºÙÙ‘Ù„ Ø§Ù„Ø¢Ù† â€” ' + S.surah.ar + ' (' + arN(curAyahNum()) + ')', '#5ec285');
});

audio.addEventListener('pause', () => {
  S.playing = false;
  document.getElementById('mainBtn').innerHTML = 'â–¶';
  document.getElementById('mainBtn').style.background = 'linear-gradient(135deg,#245c38,#3ea066)';
  document.getElementById('playDot').style.display = 'none';
});

audio.addEventListener('ended', () => {
  // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  const sl = curSlice();
  if (S.active + 1 < sl.length) {
    S.active++;
    currentUrl = '';
    updateScreen();
    renderVList();
    loadAudio(true);           // Ø´ØºÙ‘Ù„ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
  } else {
    S.playing = false;
    S.active  = 0;
    currentUrl = '';
    document.getElementById('mainBtn').innerHTML = 'â–¶';
    document.getElementById('mainBtn').style.background = 'linear-gradient(135deg,#245c38,#3ea066)';
    document.getElementById('playDot').style.display = 'none';
    updateScreen(); renderVList();
    toast$('âœ… Ø§Ù†ØªÙ‡Øª Ø§Ù„ØªÙ„Ø§ÙˆØ©');
    setStatus('Ø§Ù†ØªÙ‡Øª Ø§Ù„ØªÙ„Ø§ÙˆØ© âœ…', '#5ec285');
  }
});

audio.addEventListener('timeupdate', () => {
  const d = audio.duration || 0, c = audio.currentTime;
  const p = d ? (c / d) * 100 : 0;
  document.getElementById('pFill').style.width = p + '%';
  document.getElementById('pDot').style.left   = p + '%';
  document.getElementById('tCur').textContent  = fmt(c);
  document.getElementById('tDur').textContent  = fmt(d);
});

audio.addEventListener('error', () => {
  S.playing = false; pendingPlay = false; currentUrl = '';
  setStatus('âŒ ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª', '#f47c7c');
  document.getElementById('npSub').textContent = 'âŒ ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª';
  document.getElementById('npSub').style.color = '#f47c7c';
  document.getElementById('mainBtn').innerHTML = 'â–¶';
  document.getElementById('mainBtn').style.background = 'linear-gradient(135deg,#245c38,#3ea066)';
  document.getElementById('playDot').style.display = 'none';
});

audio.addEventListener('waiting', () => setStatus('âŸ³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...', '#e4b55a'));

/* â”€â”€ Controls â”€â”€ */
function togglePlay() {
  if (!S.sheikh) { toast$('âš  Ø§Ø®ØªØ± Ø´ÙŠØ®Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹'); return; }
  if (!S.surah)  { toast$('âš  Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹'); return; }
  if (S.playing) { audio.pause(); return; }
  const url = ayahUrl(S.sheikh, S.surah.n, curAyahNum());
  if (url === currentUrl && audio.readyState >= 2) doPlay();
  else { currentUrl = ''; loadAudio(true); }
}

function playFromStart() {
  S.active = 0; currentUrl = '';
  updateScreen(); renderVList();
  loadAudio(true);
}

function prevVerse() {
  if (S.active > 0) { S.active--; currentUrl = ''; updateScreen(); renderVList(); loadAudio(S.playing); }
}

function nextVerse() {
  if (S.active < curSlice().length - 1) { S.active++; currentUrl = ''; updateScreen(); renderVList(); loadAudio(S.playing); }
}

function seekClick(e) {
  const r = e.currentTarget.getBoundingClientRect();
  if (audio.duration) audio.currentTime = Math.max(0, Math.min(1, (e.clientX - r.left) / r.width)) * audio.duration;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderShuyukh() {
  document.getElementById('shGrid').innerHTML = SHUYUKH.map((sh, i) => `
    <div class="sh-card" onclick="pickSheikh(${i})">
      <div class="sh-flag">${sh.flag}</div>
      <div class="sh-name">${sh.name}</div>
      <div class="sh-country">${sh.country}</div>
    </div>`).join('');
}

async function pickSheikh(i) {
  S.sheikh = SHUYUKH[i];
  document.querySelectorAll('.sh-card').forEach((c, j) => c.classList.toggle('on', j === i));
  document.getElementById('elSheikh').textContent = 'ØªÙ„Ø§ÙˆØ©: ' + S.sheikh.name;
  document.getElementById('npSub').style.color = '';
  toast$('âœ“ ' + S.sheikh.name);
  if (S.surah && S.data.length) { currentUrl = ''; loadAudio(false); }
}

function renderSurahs(list = SURAHS) {
  document.getElementById('surahList').innerHTML = list.map(sr => `
    <div class="s-item ${S.surah?.n === sr.n ? 'on' : ''}" onclick="pickSurah(${sr.n})">
      <div class="s-num">${sr.n}</div>
      <div class="s-ar">${sr.ar}</div>
      <div class="s-v">${sr.v}</div>
    </div>`).join('');
}

function filterSurahs(q) {
  renderSurahs(q ? SURAHS.filter(s => s.ar.includes(q) || String(s.n).includes(q)) : SURAHS);
}

async function pickSurah(n) {
  const sr = SURAHS.find(s => s.n === n);
  if (!sr) return;
  S.surah  = sr;
  S.vFrom  = 1;
  S.vTo    = Math.min(7, sr.v);
  S.active = 0;
  currentUrl = '';
  S.data   = [];

  document.getElementById('vFrom').value = 1;
  document.getElementById('vTo').value   = S.vTo;
  document.getElementById('vAr').textContent = 'âŸ³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¢ÙŠØ§Øª ' + sr.ar + '...';
  document.getElementById('vRef').textContent = '';
  document.getElementById('vEn').textContent  = '';

  renderSurahs();
  setStatus('âŸ³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø³ÙˆØ±Ø© ' + sr.ar + '...', '#e4b55a');
  toast$('âŸ³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ ' + sr.ar);

  try {
    S.data = await loadSurahData(n);
    renderVList();
    updateScreen();
    if (S.sheikh) loadAudio(false);
    setStatus('âœ“ Ø³ÙˆØ±Ø© ' + sr.ar + ' Ø¬Ø§Ù‡Ø²Ø©', '#5ec285');
    toast$('âœ“ Ø³ÙˆØ±Ø© ' + sr.ar);
  } catch(e) {
    setStatus('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©', '#f47c7c');
    toast$('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø© â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
  }
}

function onRange() {
  S.vFrom  = Math.max(1, +document.getElementById('vFrom').value || 1);
  S.vTo    = Math.min(+document.getElementById('vTo').value || 7, S.surah?.v || 7);
  S.active = 0;
  currentUrl = '';
  renderVList();
  updateScreen();
}

function renderVList() {
  const sl = curSlice();
  document.getElementById('vList').innerHTML = sl.map((v, i) => `
    <div class="v-item ${S.active === i ? 'on' : ''}" onclick="selectVerse(${i})">
      <div class="v-num">${arN(S.vFrom + i)}</div>
      <div>
        <div class="v-ar">${v.ar}</div>
        <div class="v-en">${v.en}</div>
      </div>
    </div>`).join('');
}

function selectVerse(i) {
  S.active = i; currentUrl = '';
  updateScreen(); renderVList();
  if (S.sheikh) loadAudio(true);
  else toast$('âš  Ø§Ø®ØªØ± Ø´ÙŠØ®Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN UPDATE â€” Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateScreen() {
  if (!S.surah || !S.data.length) return;
  const v = curVerse();

  // Ø§Ù„Ù†Øµ
  document.getElementById('vAr').textContent = v.ar;
  document.getElementById('vRef').textContent = `ï´¿ ${S.surah.ar} : ${arN(curAyahNum())} ï´¾`;
  document.getElementById('vEn').textContent  = v.en;
  document.getElementById('vEn').style.display = S.fx.trans ? 'block' : 'none';

  // Ø§Ù„Ø®Ø·
  const ff = S.font==='amiri' ? "'Amiri',serif" : S.font==='cairo' ? "'Cairo',sans-serif" : "'Scheherazade New',serif";
  const el = document.getElementById('vAr');
  el.style.fontFamily = ff;
  el.style.fontSize   = S.size + 'px';
  el.style.color      = S.color;

  // Ø§Ù„Ù…ÙˆØ¶Ø¹
  const va = document.getElementById('verseArea');
  if (S.pos === 'top')    { va.style.top='14%'; va.style.bottom='auto'; va.style.transform='none'; }
  else if (S.pos==='bottom'){ va.style.top='auto'; va.style.bottom='13%'; va.style.transform='none'; }
  else                    { va.style.top='50%'; va.style.bottom='auto'; va.style.transform='translateY(-50%)'; }

  // Ø§Ù„Ù€ NowPlaying
  document.getElementById('npTitle').textContent = `${S.surah.ar} â€” Ø¢ÙŠØ© ${arN(curAyahNum())}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTROLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderBGs() {
  document.getElementById('bgGrid').innerHTML = BGS.map((b, i) => `
    <div class="bg-thumb ${S.bgIdx===i?'on':''}" style="background:${b.g}" onclick="pickBg(${i})">
      ${b.e}<div class="bg-lbl">${b.l}</div>
    </div>`).join('');
}

function pickBg(i) {
  S.bgIdx = i;
  document.getElementById('screen').style.background = BGS[i].g;
  renderBGs(); toast$('âœ“ ' + BGS[i].l);
}

function switchTab(t) {
  ['sheikh','surah','bg'].forEach((id, i) => {
    document.getElementById('tab-'+id).style.display = id===t ? 'block' : 'none';
    document.querySelectorAll('.tab')[i].classList.toggle('on', id===t);
  });
}

function setPos(btn, p) {
  S.pos = p;
  document.querySelectorAll('.pos-btn').forEach(b => b.classList.remove('on'));
  btn.classList.add('on'); updateScreen();
}

function setFont(btn, f) {
  S.font = f;
  document.querySelectorAll('.font-btn').forEach(b => b.classList.remove('on'));
  btn.classList.add('on'); updateScreen();
}

function setSize(v) {
  S.size = +v;
  document.getElementById('fsLbl').textContent = v;
  document.getElementById('fsRange').value = v;
  document.querySelectorAll('.sz-btn').forEach(b => b.classList.toggle('on', +b.textContent === +v));
  updateScreen();
}

function setColor(c, el) {
  S.color = c;
  document.querySelectorAll('.clr').forEach(d => d.classList.remove('on'));
  el.classList.add('on'); updateScreen();
}

const fxState = {moon:true, stars:true, glow:true, trans:true};
function toggleFx(k) {
  fxState[k] = !fxState[k];
  const on = fxState[k];
  const sw = document.getElementById('sw-'+k);
  sw.style.background  = on ? 'linear-gradient(135deg,#245c38,#3ea066)' : '#18301e';
  sw.style.borderColor = on ? 'rgba(62,160,102,.4)' : 'rgba(255,255,255,.08)';
  sw.querySelector('.sw-k').style.right = on ? '3px' : '19px';
  const map = {moon:'elMoon', stars:'elStars', glow:'elGlow'};
  if (map[k]) document.getElementById(map[k]).style.display = on ? 'block' : 'none';
  if (k==='trans') { S.fx.trans=on; updateScreen(); }
}

function startExport() {
  document.getElementById('expBox').style.display = 'block';
  let p = 0;
  const msgs = ['ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª...','ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª...','ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª...','Ø¶ØºØ· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...'];
  const iv = setInterval(() => {
    p += Math.random()*10+3;
    if (p >= 100) { p=100; clearInterval(iv); setTimeout(()=>{ document.getElementById('expBox').style.display='none'; toast$('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±!'); }, 500); }
    document.getElementById('expFill').style.width = p+'%';
    document.getElementById('expPct').textContent  = Math.round(p)+'%';
    document.getElementById('expMsg').textContent  = msgs[Math.min(Math.floor(p/25), msgs.length-1)];
  }, 180);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT â€” ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø¯Ø¦ÙŠ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function init() {
  const prog = document.getElementById('initProg');
  const msg  = document.getElementById('initMsg');

  // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ 3 Ø³ÙˆØ± Ø´Ø§Ø¦Ø¹Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
  const preload = [1, 112, 97];
  for (let i = 0; i < preload.length; i++) {
    msg.textContent = 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø³ÙˆØ±Ø© ' + SURAHS.find(s=>s.n===preload[i])?.ar + '...';
    prog.style.width = ((i+1)/preload.length * 80) + '%';
    try { await loadSurahData(preload[i]); } catch(e){}
  }

  prog.style.width = '100%';
  msg.textContent  = 'Ø¬Ø§Ù‡Ø²! ğŸŒ™';
  await new Promise(r => setTimeout(r, 500));

  document.getElementById('initScreen').style.display = 'none';
  document.getElementById('mainApp').style.display    = 'grid';

  renderShuyukh();
  renderSurahs();
  renderBGs();

  // Ø§Ø®ØªØ± Ø§Ù„ÙØ§ØªØ­Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
  await pickSurah(1);
}

init();
</script>
</body>
</html>
